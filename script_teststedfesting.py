"""
Tester stedfestingautomatikk

Ref https://nvdbstedfesting.atlas.vegvesen.no/swagger-ui/index.html#/Stedfesting/localizeFeatures
og https://nvdb.atlas.vegvesen.no/docs/stedfest/API-referanse 

Fokuserer spesielt p√• retning-problematikk 

curl -X 'POST' \
  'https://nvdbstedfesting.utv.atlas.vegvesen.no/api/v1/stedfest' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "parametere": {
    "maksimalAvstandTilVeg": 10,
    "veger": [
      {
        "kategori": "K",
        "fase": "V",
        "nummer": 4900
      }
    ],
    "typeVeger": [
      "ENKEL_BILVEG"
    ],
    "beregnSideposisjon": false,
    "forankring": {
      "srid": 5973,
      "startWkt": "POINT (270301.2328106925 7042034.742957044)"
    },
    "trafikantgruppe": "K"
  },
  "vegobjekter": [
    {
      "typeId": 95,
      "tempId": "skiltpunkt#1",
      "gyldighetsperiode": {
        "startdato": "2022-06-28",
        "sluttdato": "2022-10-30"
      },
      "geometri": {
        "srid": 5973,
        "wkt": "POINT (270301.2328106925 7042034.742957044)"
      }
    }
  ]
}


"""
import json 
import requests 

import pandas as pd
import geopandas as gpd

import STARTHER
import nvdbapiv3 


def lagdatasett1(): 
    data = {  "parametere": {
                "maksimalAvstandTilVeg": 20,
                "veger": [  { "kategori": "R",
                                "fase": "V",
                                # "nummer": 4900
                            }, { "kategori" : "E", "fase" : "V"} ],
                "beregnSideposisjon": True,
                # "forankring": {
                #                 "srid": 5973,
                #                 "startWkt": "POINT (146122.74682430 7006185.61897353)",
                #                 "sluttWkt": "POINT (146153.73603246  7006165.85457557)"
                #             },
                "trafikantgruppe": "K"
            },
            "vegobjekter": [
                # { "typeId": 95,
                #   "tempId": "skiltpunkt#E39",
                #   "gyldighetsperiode": { "startdato": "2023-03-07" },
                #     "geometri": {
                #         "srid": 5973,
                #         "wkt": "POINT (146122.74682430 7006185.61897353)"
                #     }
                # }, { "typeId": 95,
                #   "tempId": "skiltpunkt#Rv70",
                #   "gyldighetsperiode": { "startdato": "2023-03-07" },
                #     "geometri": {
                #         "srid": 5973,
                #         "wkt": "POINT (146153.73603246  7006165.85457557)"
                #     }
                # }, 
                { "typeId" : 5, 
                    "tempId" : "rekkverk1", 
                    "gyldighetsperiode" : { "startdato" : "2023-03-07"}, 
                    "geometri" : {
                        "srid" : 5973, 
                        "wkt" : "LINESTRING( 146126.06684240 7006184.11624101, 146131.41621914 7006180.05809314, 146150.23126839 7006167.33026571)"
                    }
                }
            ]
            }
    return data

def belysning1(): 
    
    data = { "parametere" : { "maksimalAvstandTilVeg": 20,
                "veger": [   { "kategori" : "F", "fase" : "V"}  ],
                "beregnSideposisjon": True,
                "trafikantgruppe" : "G"
                },
                "vegobjekter" : [ 
                  { "typeId" : 86, 
                   "tempId" : "belysning1",
                   "gyldighetsperiode" : { "startdato" : "2023-03-31"},
                   "geometri" : {
                      "srid" : 5973,
                      "wkt" : "LINESTRING(-35549.05999999999767169 6567856.15000000037252903, -35545.09999999999854481 6567857.76999999955296516, -35544.31999999999970896 6567858.04999999981373549, -35543.51000000000203727 6567858.25999999977648258, -35542.69000000000232831 6567858.37999999988824129, -35541.86000000000058208 6567858.42999999970197678, -35541.44999999999708962 6567858.41999999992549419, -35541.02999999999883585 6567858.40000000037252903, -35540.20999999999912689 6567858.2900000000372529, -35539.40000000000145519 6567858.11000000033527613, -35538.61000000000058208 6567857.84999999962747097, -35537.84999999999854481 6567857.50999999977648258, -35537.12999999999738066 6567857.11000000033527613, -35536.44000000000232831 6567856.63999999966472387, -35535.80999999999767169 6567856.09999999962747097, -35535.23000000000320142 6567855.50999999977648258, -35534.69999999999708962 6567854.87000000011175871, -35528.37000000000261934 6567846.28000000026077032, -35527.87999999999738066 6567845.69000000040978193, -35527.34999999999854481 6567845.15000000037252903, -35526.76000000000203727 6567844.66000000014901161, -35526.13999999999941792 6567844.23000000044703484, -35525.47000000000116415 6567843.86000000033527613, -35524.76999999999679858 6567843.54999999981373549, -35524.04000000000087311 6567843.30999999959021807, -35523.30000000000291038 6567843.15000000037252903, -35522.54000000000087311 6567843.04999999981373549, -35521.77999999999883585 6567843.03000000026077032, -35521.01999999999679858 6567843.07000000029802322, -35520.26999999999679858 6567843.19000000040978193, -35519.52999999999883585 6567843.38999999966472387, -35518.80999999999767169 6567843.65000000037252903, -35514.37000000000261934 6567845.5, -35513.56999999999970896 6567845.79999999981373549, -35512.73999999999796273 6567846.03000000026077032, -35511.88999999999941792 6567846.19000000040978193, -35511.02999999999883585 6567846.26999999955296516, -35510.16999999999825377 6567846.28000000026077032, -35509.30999999999767169 6567846.2099999999627471, -35508.45999999999912689 6567846.07000000029802322, -35507.62999999999738066 6567845.86000000033527613, -35506.80999999999767169 6567845.58000000007450581, -35506.02999999999883585 6567845.23000000044703484, -35505.13999999999941792 6567844.7900000000372529, -35504.33000000000174623 6567844.42999999970197678, -35503.48999999999796273 6567844.13999999966472387, -35502.62000000000261934 6567843.92999999970197678, -35501.73999999999796273 6567843.7900000000372529, -35500.86000000000058208 6567843.73000000044703484, -35499.97000000000116415 6567843.75999999977648258, -35499.08000000000174623 6567843.86000000033527613, -35498.20999999999912689 6567844.0400000000372529, -35497.36000000000058208 6567844.2900000000372529, -35496.52999999999883585 6567844.62000000011175871, -35495.73999999999796273 6567845.03000000026077032, -35494.98000000000320142 6567845.5, -35494.26999999999679858 6567846.03000000026077032, -35493.61000000000058208 6567846.62999999988824129, -35493.01000000000203727 6567847.28000000026077032, -35492.47000000000116415 6567847.99000000022351742, -35492.08999999999650754 6567848.51999999955296516, -35491.40000000000145519 6567849.44000000040978193, -35490.66999999999825377 6567850.30999999959021807, -35489.87999999999738066 6567851.13999999966472387, -35489.05000000000291038 6567851.92999999970197678, -35488.18000000000029104 6567852.66000000014901161, -35487.26000000000203727 6567853.34999999962747097, -35486.30999999999767169 6567853.98000000044703484, -35485.31999999999970896 6567854.55999999959021807, -35474.51999999999679858 6567860.48000000044703484, -35469.11000000000058208 6567863.44000000040978193, -35466.41000000000349246 6567864.91999999992549419, -35465.05999999999767169 6567865.66000000014901161, -35464.38999999999941792 6567866.03000000026077032, -35463.70999999999912689 6567866.40000000037252903)"
                   }
                  }
                ]
            }
    return data

def belysning2(): 
    
    data = { "parametere" : { "maksimalAvstandTilVeg": 20,
                "veger": [   { "kategori" : "F", "fase" : "V"}  ],
                "beregnSideposisjon": True,
                "trafikantgruppe" : "G"
                },
                "vegobjekter" : [ 
                  { "typeId" : 86, 
                   "tempId" : "styggBelysning2",
                   "gyldighetsperiode" : { "startdato" : "2023-03-31"},
                   "geometri" : {
                      "srid" : 5973,
                      "wkt" : "LINESTRING Z( -35513.95740060335 6567862.383422427 -0.08106882125139236, -35509.30323643226 6567863.434990903 -0.08106234669685364, -35498.389152186806 6567857.81258383  -0.081043541431427, -35463.99325030309 6567862.194754032 -0.08099422603845596 )"
                   } 
                  }, { "typeId" : 86, 
                      "tempId" : "StyggBelysning1",
                      "gyldighetsperiode" : { "startdato" : "2023-03-31"},
                      "geometri" : {
                          "srid" : 5973,
                          "wkt" : "LINESTRING Z( -35548.90813306975 6567861.698659324 -0.08112068474292755, -35533.529196168645 6567865.419369878 -0.08109938353300095, -35529.06434352591 6567858.9701382425 -0.08108983933925629, -35513.95740060335 6567862.383422427 -0.08106882125139236)"
                      }
                  }
                ]
            }
    return data

def belysning3():
    data = { "parametere" : { "maksimalAvstandTilVeg": 20,
                "veger": [   { "kategori" : "F", "fase" : "V"}  ],
                "beregnSideposisjon": True,
                "trafikantgruppe" : "G"
                },
                "vegobjekter" : [ 
                  { "typeId" : 86, 
                   "tempId" : "styggbelysning",
                   "gyldighetsperiode" : { "startdato" : "2023-03-31"},
                   "geometri" : {
                      "srid" : 5973,
                      "wkt" : "LINESTRING Z ( -35548.90813306975 6567861.698659324 -0.08112068474292755, -35533.529196168645 6567865.419369878 -0.08109938353300095, -35529.06434352591 6567858.9701382425 -0.08108983933925629, -35509.30323643226 6567863.434990903 -0.08106234669685364, -35498.389152186806 6567857.81258383  -0.081043541431427, -35463.99325030309 6567862.194754032 -0.08099422603845596 )"   
                      }
                  }
                ]
            }
    return data



if __name__ == '__main__': 

    # Stedfestingeksempel 
    url = 'https://nvdbstedfesting.atlas.vegvesen.no/api/v1/stedfest'
    url = 'https://nvdbstedfesting.test.atlas.vegvesen.no/api/v1/stedfest'
    headers = { 'accept' : 'application/json', 'Content-Type' : 'application/json'}
    
    data0 = lagdatasett1()
    data = belysning3()
    # data['parametere'].pop( 'trafikantgruppe')
    r = requests.post( url, headers=headers, data=json.dumps( data ) )
    print( json.dumps( r.json(), indent=4, ensure_ascii=False))